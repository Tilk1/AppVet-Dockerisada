<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <%- include ('header', {tituloweb: '¡Oh my dog! | Cupones'}); %>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  </head>

<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            background: #dedede;
        }
        .coupon .kanan {
            border-left: 1px dashed #ddd;
            width: 40% !important;
            position: relative;
        }

        .coupon .kanan .info::after,
        .coupon .kanan .info::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: #4998b0;
            border-radius: 100%;
        }
        .coupon .kanan .info::before {
            top: -10px;
            left: -10px;
        }

        .coupon .kanan .info::after {
            bottom: -10px;
            left: -10px;
        }
        .coupon .time {
            font-size: 1.6rem;
        }
    </style>
</head>
<body id="body">
    
    <div class="card" style="width: 100%; margin-top: 10px;">
        <p class="text-center h1 fw-bold mb-4 mx-1 mx-md-4 mt-3"><i class="bi bi-clipboard-data"></i> Reportes</p>
    </div>
    
    <div class="container my-2">
        <div class="alert alert-info alert-dismissible fade show" role="alert">
            Nota: Los reportes incluyen <strong>TODA</strong> la informacion registrada del mes seleccionado, esto incluye informacion relacionada con practicas por ejemplo de mascotas que ya hayan sido eliminadas.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
    </div>
    <div class="container my-4" style="background-color: #ffffff ; border-radius: 10px;">
        <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
              <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Practicas</button>
              <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Adopciones</button>
            </div>
          </nav>
          <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                <div class="col-7 m-1">
                    Practicas realizadas a todas las mascotas en el mes seleccionado
                </div>
                <div class="col-5">
                    <div class="input-group">
                      <input class="form-control form-control-user m-1" type="month" id="fecha_reporte_practicas">
                      <div class="input-group-append">
                        <a class="btn btn-outline-primary m-1" href="/generar_reporte_practicas">
                          <i class="bi bi-pencil-square"></i> Generar reporte
                        </a>
                      </div>
                    </div>
                  </div>
                  <!-- tabla -->

                  <div class="table-responsive">
                    <caption>
                    <div class="caption-heading">Historial de visitas</div>
                   </caption>
                   <table class="table" id="tabla1">
                       <thead class="table-secondary">
                           <tr>
                               <th class="text-center" scope="col">Fecha</th>
                               <th class="text-center" scope="col">Mascota</th>
                               <th class="text-center" scope="col">Practica</th>
                               <th class="text-center" scope="col">Observaciones</th>
                               <th class="text-center" scope="col">Monto de la consulta</th>

                           </tr>
                       </thead>
                       <tbody>
                           <% let indice = 0; %>
                                   <% if (practicas && practicas.length > 0) { %>
                                        <% practicas.forEach(historial=> { %>
                                        <% const fechaCorta = visita.fecha.split(" ")[0]; %>
                                   <tr class="paginate">
                                       <td class="text-center align-middle">
                                           <%= fechaCorta %>
                                       </td>
                                       <td class="text-center align-middle">
                                           <%= visita.nombre %>
                                       </td>
                                       <td class="text-center align-middle">
                                           <%= visita.practica %>
                                       </td>
                                       <td class="text-center align-middle">
                                           <%= visita.observacion %>
                                       </td>

                                       <td class="text-center align-middle">
                                           <div class="card">
                                             <button class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse" data-bs-target="#collapseContent<%= indice %>" aria-expanded="false" aria-controls="collapseContent">
                                               <i class="bi bi-cash"></i> Ver más
                                             </button>
                                         
                                             <div id="collapseContent<%= indice %>" class="collapse">
                                               <!-- Contenido colapsable del botón -->
                                               <div class="card-body">
                                                 <p>Monto consulta: $<%= visita.monto_abonado %></p>
                                                 <% if (visita.monto_beneficio > 0) { %>
                                                   <p>Monto Beneficio: $<%= visita.monto_beneficio %></p>
                                                   <% } %>
                                                   <p>--------------------------------------</p>
                                                   <% if (visita.monto_abonado >= visita.monto_beneficio) { %>
                                                     <p>Total $<%= visita.monto_abonado - visita.monto_beneficio %></p>
                                                   <% } else { %>
                                                     <p>Total $0</p>
                                                   <% } %>
                                                 
                                               </div>
                                             </div>
                                           </div>
                                         </td>

                                   </tr>
                                   <% indice++; %>
                                   <% }); %>
                                       <% } %>
                          
                       </tbody>
                   </table>
                  </div>
                 <!--   fin tabla -->
                
                 
            </div>
            <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                <div class="col-5 m-1">
                Adopciones realizadas en el mes seleccionado
                </div>
                <div class="col-5">
                    <div class="input-group">
                      <input class="form-control form-control-user m-1" type="month" id="fecha_reporte_adopciones">
                      <div class="input-group-append">
                        <a class="btn btn-outline-primary m-1" href="/generar_reporte_adopciones">
                          <i class="bi bi-pencil-square"></i> Generar reporte
                        </a>
                      </div>
                    </div>
                </div>
            <br>


            </div>
          </div>

</div>
        <div class="text-center"><a class="small" style="color: white;" href="/">Volver</a></div>
        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
        <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
        <style>
            .dataTables_wrapper .search-container {
                text-align: center;
                margin-top: 25px;
                margin-bottom: 25px;
            }
        
            .dataTables_wrapper .dataTables_filter {
                display: inline-block;
            }
        </style>
                <style>
                  .dataTables_empty {
                      text-align: center;
                      color: #9e1f1f;
                      font-style: italic;
                  }
              </style>
        <script>
          $(document).ready(function () {
              const tableRows = $('#tabla1 tbody tr').length;
              const pagingEnable = tableRows > 50;
              $('#tabla1').DataTable({
                  paging: pagingEnable,
                  ordering: false,
                  dom: '<"top"i>rt<"search-container"lf><"bottom"lp><"clear">',
                  info: false,
                  columns: [
                      { "searchable": false },
                      { "searchable": true }, //nombre mascota,
                      { "searchable": false }, 
                      { "searchable": false }, 
                      { "searchable": false },
                  ],
                  lengthMenu: [
                      [5, 15, 50, -1],
                      [5, 15, 50, 'Todos'],
                  ],
                  pageLength: 50, // Establecer como la opción por defecto
                  searching: true, // deshabilita la función de búsqueda
                  language: {
                      paginate: { previous: 'Anterior', next: 'Siguiente', },
                      zeroRecords: 'No hay datos registrados para el mes elegido',
                      info: 'Mostrando pagina _PAGE_ de _PAGES_',
                      infoEmpty: 'No hay datos registrados para el mes elegido',
                      search: 'Buscar por nombre de mascota',
                      lengthMenu: 'Mostrar _MENU_ entradas',
                  },

              });

          });
      </script>
</body>
</html>