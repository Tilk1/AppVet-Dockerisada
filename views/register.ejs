<!DOCTYPE html>
<html lang="en">
<head>  
<%- include ('header') %>
</head>
<body id="body">
    <!DOCTYPE html>
    <html lang="en">
    
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
        <title>Untitled</title>
        <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    </head>
    
    <body>
        <div class="container" style="position: absolute;left: 0;right: 0;top: 50%;transform: translateY(-50%);-ms-transform: translateY(-50%);-moz-transform: translateY(-50%);-webkit-transform: translateY(-50%);-o-transform: translateY(-50%);">
            <div class="row d-flex d-xl-flex justify-content-center justify-content-xl-center">
                <div class="col-sm-12 col-lg-10 col-xl-9 col-xxl-7 bg-white shadow-lg" style="border-radius: 5px;">
                    <div class="p-5">
                        <div class="text-center">
                            <h4 class="text-dark mb-4">Crear una cuenta</h4>
                        </div>
                        <form action="/register" method="POST">
                            <div class="mb-3"><input class="form-control form-control-user" type="email" name="mail" id="email" placeholder="Correo electronico" required=""></div>
                            <div class="mb-3"><input class="form-control form-control-user" type="text" name="name" placeholder="Nombre completo" required=""></div>
                            <div class="row mb-3">
                                <div class="col-sm-6 mb-3 mb-sm-0"><input class="form-control form-control-user" name="pass" type="password" id="password" placeholder="Contrase침a" required=""></div>
                                <div class="col-sm-6">  <input type="radio" class="btn-check" name="rol" id="btnradio1" autocomplete="off" checked>
                                                        <label class="btn btn-outline-primary" for="btnradio1">Cliente</label>
                                                        <input type="radio" class="btn-check" name="rol" id="btnradio2" autocomplete="off">
                                                        <label class="btn btn-outline-primary" for="btnradio2">Admin</label></div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-sm-6 mb-3 mb-sm-0"><input class="form-control form-control-user" type="number" name="DNI" id="DNI" placeholder="DNI" required=""></div>
                                <div class="col-sm-6"><input class="form-control form-control-user" type="number" name="tel" id="tel" placeholder="Telefono de contacto" required=""></div>
                            </div>
                            <div class="row mb-3">
                                <p id="emailDuplicateErrorMsg" class="text-danger" style="display: none;"></p>
                                <p id="emailErrorMsg" class="text-danger" style="display: none;">Paragraph</p>
                                <p id="passwordErrorMsg" class="text-danger" style="display: none;">Paragraph</p>
                            </div><button class="btn btn-primary d-block btn-user w-100" id="submitBtn" type="submit">Registrar</button>
                            <hr>
                        </form>
                        <div class="text-center"><a class="small" href="/">Volver</a></div>
                    </div>
                </div>
            </div><script>
        let email = document.getElementById("email")
        let password = document.getElementById("password")
        let submitBtn = document.getElementById("submitBtn")
        let emailErrorMsg = document.getElementById('emailErrorMsg')
        let passwordErrorMsg = document.getElementById('passwordErrorMsg')
    
        function displayErrorMsg(type, msg) {
            if(type == "email") {
                emailErrorMsg.style.display = "block"
                emailErrorMsg.innerHTML = msg
                submitBtn.disabled = true
            }
            else {
                passwordErrorMsg.style.display = "block"
                passwordErrorMsg.innerHTML = msg
                submitBtn.disabled = true
            }
        }
    
        function hideErrorMsg(type) {
            if(type == "email") {
                emailErrorMsg.style.display = "none"
                emailErrorMsg.innerHTML = ""
                if(passwordErrorMsg.innerHTML == "")
                    submitBtn.disabled = false
            }
            else {
                passwordErrorMsg.style.display = "none"
                passwordErrorMsg.innerHTML = ""
                if(emailErrorMsg.innerHTML == "")
                    submitBtn.disabled = false
            }
        }
        
        // Validate password upon change
        password.addEventListener("input", function() {
    
            // If password has no value, then it won't be changed and no error will be displayed
            if(password.value.length == 0) hideErrorMsg("password")
            
            // Check if the password has 8 characters or more
            if(password.value.length >= 8)
                hideErrorMsg("password")
            else
                displayErrorMsg("password", "La contrase침a debe contener al menos 8 caracteres")
        });



        // Validate email upon change
        email.addEventListener("input", async function() {
        // Check if the email is valid using a regular expression (string@string.string)
        if(email.value.match(/^[^@]+@[^@]+\.[^@]+$/)) {
            //busca en el servidor si ya existe
            const response = await fetch('/chequear_mail_duplicado', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email: email.value
                })
            });
            
            const data = await response.json();

            if (data.exists) {
                displayErrorMsg("email", "El correo electr칩nico ya est치 en uso");
                document.getElementById("emailDuplicateErrorMsg").style.display = "block";
            } else {
                hideErrorMsg("email");
                document.getElementById("emailDuplicateErrorMsg").style.display = "none";
            }
            } 
        else {
            displayErrorMsg("email", "Correo invalido");
        }
    });

    </script>
        </div>
        <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    </body>
    
    </html>
    <%- include ('sweet-alert') %>

</body>
</html>

